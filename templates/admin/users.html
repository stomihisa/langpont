<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - LangPont ç®¡ç†è€…</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <!-- ğŸš€ ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ - Task 2.9.2 Phase B-1 -->
    <div class="admin-container">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="admin-header">
            <div class="header-left">
                <h1>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h1>
                <span class="version-badge">Phase B-1</span>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <span class="user-role {{ user_info.role }}">{{ user_info.role|upper }}</span>
                    <span class="username">{{ user_info.username }}</span>
                </div>
                <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª</a>
            </div>
        </header>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="admin-nav">
            <a href="{{ url_for('admin.dashboard') }}" class="nav-item">
                ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
            </a>
            <a href="{{ url_for('admin.task292_monitor') }}" class="nav-item">
                ğŸ” Task 2.9.2 ç›£è¦–
            </a>
            <a href="{{ url_for('admin.users') }}" class="nav-item active">
                ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
            </a>
            <a href="{{ url_for('admin.logs') }}" class="nav-item">
                ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°
            </a>
            <a href="{{ url_for('admin.analytics') }}" class="nav-item">
                ğŸ“ˆ ãƒ‡ãƒ¼ã‚¿åˆ†æ
            </a>
        </nav>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="admin-main">
            
            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
            <section class="user-stats">
                <div class="section-card">
                    <div class="section-header">
                        <h2>ğŸ“Š ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ</h2>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ“</div>
                            <div class="stat-content">
                                <h3>ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</h3>
                                <p class="stat-number">{{ users_data|length + existing_users|length }}</p>
                                <small>ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</small>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ”</div>
                            <div class="stat-content">
                                <h3>ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h3>
                                <p class="stat-number">{{ existing_users|selectattr('role', 'equalto', 'admin')|list|length }}</p>
                                <small>adminæ¨©é™ãƒ¦ãƒ¼ã‚¶ãƒ¼</small>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">âš™ï¸</div>
                            <div class="stat-content">
                                <h3>é–‹ç™ºè€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h3>
                                <p class="stat-number">{{ existing_users|selectattr('role', 'equalto', 'developer')|list|length }}</p>
                                <small>developeræ¨©é™ãƒ¦ãƒ¼ã‚¶ãƒ¼</small>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ‘¤</div>
                            <div class="stat-content">
                                <h3>ã‚²ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</h3>
                                <p class="stat-number">{{ existing_users|selectattr('role', 'equalto', 'guest')|list|length }}</p>
                                <small>guestæ¨©é™ãƒ¦ãƒ¼ã‚¶ãƒ¼</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆconfig.pyç”±æ¥ï¼‰ -->
            <section class="existing-users">
                <div class="section-card">
                    <div class="section-header">
                        <h2>ğŸ›ï¸ æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ (config.py)</h2>
                        <span class="user-count-badge">{{ existing_users|length }}å</span>
                    </div>
                    <div class="users-table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                                    <th>æ¨©é™ãƒ¬ãƒ™ãƒ«</th>
                                    <th>æ—¥æ¬¡åˆ¶é™</th>
                                    <th>èª¬æ˜</th>
                                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in existing_users %}
                                <tr class="user-row {{ user.role }}">
                                    <td class="username-cell">
                                        <span class="username">{{ user.username }}</span>
                                        <span class="source-badge">{{ user.source }}</span>
                                    </td>
                                    <td class="role-cell">
                                        <span class="role-badge {{ user.role }}">{{ user.role|upper }}</span>
                                    </td>
                                    <td class="limit-cell">
                                        {% if user.daily_limit == -1 %}
                                            <span class="unlimited">âˆ ç„¡åˆ¶é™</span>
                                        {% else %}
                                            <span class="limited">{{ user.daily_limit }}å›/æ—¥</span>
                                        {% endif %}
                                    </td>
                                    <td class="description-cell">{{ user.description }}</td>
                                    <td class="status-cell">
                                        <span class="status-active">ğŸŸ¢ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆuser_auth.pyç”±æ¥ï¼‰ -->
            {% if users_data %}
            <section class="registered-users">
                <div class="section-card">
                    <div class="section-header">
                        <h2>ğŸ†• æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)</h2>
                        <span class="user-count-badge">{{ users_data|length }}å</span>
                    </div>
                    <div class="users-table-container">
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼å</th>
                                    <th>ãƒ¡ãƒ¼ãƒ«</th>
                                    <th>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç¨®åˆ¥</th>
                                    <th>Early Access</th>
                                    <th>æ—¥æ¬¡ä½¿ç”¨å›æ•°</th>
                                    <th>ç™»éŒ²æ—¥</th>
                                    <th>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users_data %}
                                <tr class="user-row {{ user.account_type }}">
                                    <td class="id-cell">{{ user.id }}</td>
                                    <td class="username-cell">
                                        <span class="username">{{ user.username }}</span>
                                        <span class="source-badge">database</span>
                                    </td>
                                    <td class="email-cell">{{ user.email }}</td>
                                    <td class="account-type-cell">
                                        <span class="role-badge {{ user.account_type }}">{{ user.account_type|upper }}</span>
                                    </td>
                                    <td class="early-access-cell">
                                        {% if user.early_access %}
                                            <span class="early-access">âœ… æœ‰åŠ¹</span>
                                        {% else %}
                                            <span class="no-early-access">âŒ ç„¡åŠ¹</span>
                                        {% endif %}
                                    </td>
                                    <td class="usage-cell">
                                        <span class="usage-count">{{ user.daily_usage_count or 0 }}</span>
                                    </td>
                                    <td class="created-cell">
                                        {{ user.created_at.split('T')[0] if user.created_at else 'ä¸æ˜' }}
                                    </td>
                                    <td class="actions-cell">
                                        <button class="btn btn-small btn-outline" onclick="viewUserDetails({{ user.id }})">
                                            è©³ç´°
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            {% else %}
            <section class="no-registered-users">
                <div class="section-card">
                    <div class="text-center">
                        <h2>ğŸ†• æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼</h2>
                        <p style="color: var(--text-secondary); margin-top: 1rem;">
                            ã¾ã æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚<br>
                            ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã‚’è¡Œã†ã¨ã€ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                        </p>
                    </div>
                </div>
            </section>
            {% endif %}

            <!-- ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ -->
            <section class="permissions-matrix">
                <div class="section-card">
                    <div class="section-header">
                        <h2>ğŸ” æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹</h2>
                    </div>
                    <div class="permissions-table-container">
                        <table class="permissions-table">
                            <thead>
                                <tr>
                                    <th>æ¨©é™</th>
                                    <th>admin</th>
                                    <th>developer</th>
                                    <th>premium</th>
                                    <th>basic</th>
                                    <th>guest</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                </tr>
                                <tr>
                                    <td>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                </tr>
                                <tr>
                                    <td>ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                </tr>
                                <tr>
                                    <td>ãƒ‡ãƒ¼ã‚¿åˆ†æ</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                    <td class="perm-denied">âŒ</td>
                                </tr>
                                <tr>
                                    <td>ç¿»è¨³æ©Ÿèƒ½</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-granted">âœ…</td>
                                    <td class="perm-granted">âœ…</td>
                                </tr>
                                <tr>
                                    <td>ä½¿ç”¨åˆ¶é™</td>
                                    <td class="perm-unlimited">âˆ</td>
                                    <td class="perm-high">1000/æ—¥</td>
                                    <td class="perm-medium">100/æ—¥</td>
                                    <td class="perm-low">50/æ—¥</td>
                                    <td class="perm-very-low">10/æ—¥</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

        </main>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer class="admin-footer">
            <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | LangPont Admin Dashboard Phase B-1</p>
            <div class="footer-actions">
                <button onclick="refreshUserData()" class="btn btn-small">ğŸ”„ æ›´æ–°</button>
                <button onclick="exportUserData()" class="btn btn-small">ğŸ“Š ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
        </footer>

    </div>

    <script>
        // ğŸš€ ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ JavaScript
        
        function viewUserDetails(userId) {
            alert(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${userId} ã®è©³ç´°è¡¨ç¤ºæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚`);
            // å°†æ¥çš„ã«ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚„ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°ã‚’è¡¨ç¤º
        }
        
        function refreshUserData() {
            console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æ›´æ–°...');
            location.reload();
        }
        
        function exportUserData() {
            console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ...');
            alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚');
            // å°†æ¥çš„ã«ã¯CSVã‚„JSONã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        }

        // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆå°†æ¥å®Ÿè£…ç”¨ï¼‰
        function sortTable(columnIndex) {
            console.log(`åˆ— ${columnIndex} ã§ã‚½ãƒ¼ãƒˆ`);
            // å°†æ¥çš„ã«ã¯ãƒ†ãƒ¼ãƒ–ãƒ«ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’å®Ÿè£…
        }

        // åˆæœŸåŒ–
        console.log('ğŸš€ LangPontç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢ Phase B-1 åˆæœŸåŒ–å®Œäº†');
    </script>

    <style>
        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .user-count-badge {
            background: var(--primary-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .users-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .users-table th,
        .users-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .users-table th {
            background: var(--bg-light);
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-row:hover {
            background: var(--bg-light);
        }

        .username {
            font-weight: 600;
            color: var(--text-primary);
        }

        .source-badge {
            background: var(--bg-light);
            color: var(--text-secondary);
            padding: 0.125rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 0.5rem;
        }

        .role-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-badge.admin {
            background: var(--danger-red);
            color: white;
        }

        .role-badge.developer {
            background: var(--success-green);
            color: white;
        }

        .role-badge.premium {
            background: var(--warning-orange);
            color: white;
        }

        .role-badge.basic {
            background: var(--info-cyan);
            color: white;
        }

        .role-badge.guest {
            background: var(--text-secondary);
            color: white;
        }

        .unlimited {
            color: var(--success-green);
            font-weight: 600;
        }

        .limited {
            color: var(--text-secondary);
        }

        .status-active {
            color: var(--success-green);
            font-weight: 500;
        }

        .early-access {
            color: var(--success-green);
            font-weight: 500;
        }

        .no-early-access {
            color: var(--text-secondary);
        }

        .usage-count {
            font-weight: 600;
            color: var(--primary-blue);
        }

        /* æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ */
        .permissions-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .permissions-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .permissions-table th,
        .permissions-table td {
            padding: 0.75rem;
            text-align: center;
            border-bottom: 1px solid var(--border-light);
        }

        .permissions-table th {
            background: var(--bg-light);
            font-weight: 600;
        }

        .permissions-table td:first-child {
            text-align: left;
            font-weight: 500;
        }

        .perm-granted {
            color: var(--success-green);
        }

        .perm-denied {
            color: var(--text-secondary);
        }

        .perm-unlimited {
            color: var(--success-green);
            font-weight: 600;
        }

        .perm-high {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .perm-medium {
            color: var(--warning-orange);
            font-weight: 600;
        }

        .perm-low {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .perm-very-low {
            color: var(--danger-red);
            font-weight: 600;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .users-table-container {
                font-size: 0.75rem;
            }
            
            .users-table th,
            .users-table td {
                padding: 0.5rem;
            }
            
            .source-badge {
                display: none;
            }
        }
    </style>
</body>
</html>