<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - LangPont ç®¡ç†è€…</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- ğŸš€ ç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿åˆ†æç”»é¢ - Task 2.9.2 Phase B-1 -->
    <div class="admin-container">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="admin-header">
            <div class="header-left">
                <h1>ğŸ“ˆ ãƒ‡ãƒ¼ã‚¿åˆ†æ</h1>
                <span class="version-badge">Phase B-1</span>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <span class="user-role {{ user_info.role }}">{{ user_info.role|upper }}</span>
                    <span class="username">{{ user_info.username }}</span>
                </div>
                <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª</a>
            </div>
        </header>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        <nav class="admin-nav">
            <a href="{{ url_for('admin.dashboard') }}" class="nav-item">
                ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
            </a>
            <a href="{{ url_for('admin.task292_monitor') }}" class="nav-item">
                ğŸ” Task 2.9.2 ç›£è¦–
            </a>
            {% if user_info.role == 'admin' %}
            <a href="{{ url_for('admin.users') }}" class="nav-item">
                ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
            </a>
            {% endif %}
            <a href="{{ url_for('admin.logs') }}" class="nav-item">
                ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°
            </a>
            <a href="{{ url_for('admin.analytics') }}" class="nav-item active">
                ğŸ“ˆ ãƒ‡ãƒ¼ã‚¿åˆ†æ
            </a>
        </nav>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="admin-main">
            
            <!-- åˆ†ææœŸé–“é¸æŠ -->
            <section class="analytics-controls">
                <div class="section-card">
                    <div class="section-header">
                        <h2>âš™ï¸ åˆ†æè¨­å®š</h2>
                    </div>
                    
                    <form method="GET" class="controls-form">
                        <div class="controls-grid">
                            <div class="control-group">
                                <label for="days">åˆ†ææœŸé–“</label>
                                <select id="days" name="days" onchange="this.form.submit()">
                                    <option value="1" {{ 'selected' if days == 1 }}>éå»1æ—¥</option>
                                    <option value="7" {{ 'selected' if days == 7 }}>éå»7æ—¥</option>
                                    <option value="30" {{ 'selected' if days == 30 }}>éå»30æ—¥</option>
                                    <option value="90" {{ 'selected' if days == 90 }}>éå»90æ—¥</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label>ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
                                <div class="quick-actions">
                                    <button type="button" onclick="refreshAnalytics()" class="btn btn-small">ğŸ”„ æ›´æ–°</button>
                                    <button type="button" onclick="exportAnalytics()" class="btn btn-small btn-outline">ğŸ“Š ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </section>

            <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ -->
            <section class="performance-stats">
                <div class="section-card">
                    <div class="section-header">
                        <h2>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ</h2>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">âš¡</div>
                            <div class="stat-content">
                                <h3>å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“</h3>
                                <p class="stat-number">{{ "%.0f"|format(performance_data.avg_response_time) }}ms</p>
                                <small>APIå¿œç­”é€Ÿåº¦</small>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ”—</div>
                            <div class="stat-content">
                                <h3>ç·APIå‘¼ã³å‡ºã—</h3>
                                <p class="stat-number">{{ performance_data.total_api_calls }}</p>
                                <small>ç´¯è¨ˆAPIä½¿ç”¨å›æ•°</small>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">âœ…</div>
                            <div class="stat-content">
                                <h3>æˆåŠŸç‡</h3>
                                <p class="stat-number">{{ performance_data.success_rate }}%</p>
                                <small>ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡</small>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ğŸ”„</div>
                            <div class="stat-content">
                                <h3>ç·ç¿»è¨³æ•°</h3>
                                <p class="stat-number">{{ system_stats.total_translations }}</p>
                                <small>ç´¯è¨ˆç¿»è¨³å›æ•°</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ç¿»è¨³ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ -->
            <section class="translation-trends">
                <div class="section-card">
                    <h2>ğŸ“ˆ ç¿»è¨³ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ ({{ days }}æ—¥é–“)</h2>
                    <div class="trends-container">
                        <div class="trend-chart">
                            <canvas id="translationTrendChart"></canvas>
                        </div>
                        <div class="trend-summary">
                            <h3>ğŸ” ãƒˆãƒ¬ãƒ³ãƒ‰ã‚µãƒãƒªãƒ¼</h3>
                            <div class="summary-stats">
                                <div class="summary-item">
                                    <span class="summary-label">ç·ç¿»è¨³æ•°:</span>
                                    <span class="summary-value">{{ translation_analytics.daily_translations|length and translation_analytics.daily_translations|map(attribute='count')|sum or 0 }}å›</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">1æ—¥å¹³å‡:</span>
                                    <span class="summary-value">{{ "%.1f"|format((translation_analytics.daily_translations|length and translation_analytics.daily_translations|map(attribute='count')|sum / translation_analytics.daily_translations|length) or 0) }}å›</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">æœ€å¤§1æ—¥:</span>
                                    <span class="summary-value">{{ translation_analytics.daily_translations|length and translation_analytics.daily_translations|map(attribute='count')|max or 0 }}å›</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ—¥æ•°:</span>
                                    <span class="summary-value">{{ translation_analytics.daily_translations|selectattr('count', 'greaterthan', 0)|list|length }}æ—¥</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Geminiæ¨å¥¨åˆ†æ -->
            <section class="gemini-recommendation-analysis">
                <div class="section-card">
                    <h2>ğŸ§  Geminiæ¨å¥¨åˆ†æ</h2>
                    <div class="gemini-analysis-container">
                        <div class="gemini-chart">
                            <canvas id="geminiRecommendationChart"></canvas>
                        </div>
                        <div class="gemini-insights">
                            <h3>ğŸ’¡ æ¨å¥¨ã‚¤ãƒ³ã‚µã‚¤ãƒˆ</h3>
                            <div class="insights-list">
                                {% for engine, count in performance_data.gemini_recommendations.items() %}
                                <div class="insight-item">
                                    <div class="insight-header">
                                        <span class="engine-name">{{ engine.title() }}</span>
                                        <span class="recommendation-count">{{ count }}å›</span>
                                    </div>
                                    <div class="insight-description">
                                        {% if engine == 'chatgpt' %}
                                            æ¨™æº–çš„ã§ä¿¡é ¼æ€§ã®é«˜ã„ç¿»è¨³ã¨ã—ã¦æ¨å¥¨ã•ã‚Œã‚‹å‚¾å‘
                                        {% elif engine == 'enhanced' %}
                                            ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ã—ãŸé«˜å“è³ªç¿»è¨³ã¨ã—ã¦æ¨å¥¨
                                        {% elif engine == 'gemini' %}
                                            å‰µé€ æ€§ã¨è‡ªç„¶ã•ã‚’é‡è¦–ã—ãŸç¿»è¨³ã¨ã—ã¦æ¨å¥¨
                                        {% else %}
                                            ãã®ä»–ã®ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æ -->
            <section class="user-behavior">
                <div class="section-card">
                    <h2>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æ</h2>
                    <div class="behavior-grid">
                        <div class="top-users-panel">
                            <h3>ğŸ† ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ TOP10</h3>
                            <div class="users-list">
                                {% for user in translation_analytics.top_users %}
                                <div class="user-item">
                                    <div class="user-info">
                                        <span class="user-name">{{ user.username }}</span>
                                        <span class="user-count">{{ user.count }}å›</span>
                                    </div>
                                    <div class="user-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: {{ (user.count / translation_analytics.top_users[0].count * 100) if translation_analytics.top_users else 0 }}%"></div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="usage-patterns">
                            <h3>ğŸ“Š åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³</h3>
                            <div class="pattern-stats">
                                <div class="pattern-item">
                                    <span class="pattern-icon">â°</span>
                                    <div class="pattern-content">
                                        <h4>ãƒ”ãƒ¼ã‚¯æ™‚é–“</h4>
                                        <p>14:00-16:00 (æ¨å®š)</p>
                                    </div>
                                </div>
                                <div class="pattern-item">
                                    <span class="pattern-icon">ğŸ“…</span>
                                    <div class="pattern-content">
                                        <h4>ãƒ”ãƒ¼ã‚¯æ›œæ—¥</h4>
                                        <p>ç«æ›œæ—¥ãƒ»æ°´æ›œæ—¥ (æ¨å®š)</p>
                                    </div>
                                </div>
                                <div class="pattern-item">
                                    <span class="pattern-icon">ğŸ¯</span>
                                    <div class="pattern-content">
                                        <h4>å¹³å‡ã‚»ãƒƒã‚·ãƒ§ãƒ³</h4>
                                        <p>2.5å›/ã‚»ãƒƒã‚·ãƒ§ãƒ³ (æ¨å®š)</p>
                                    </div>
                                </div>
                                <div class="pattern-item">
                                    <span class="pattern-icon">ğŸ”„</span>
                                    <div class="pattern-content">
                                        <h4>ãƒªãƒ”ãƒ¼ãƒˆç‡</h4>
                                        <p>75% (æ¨å®š)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§æŒ‡æ¨™ -->
            <section class="system-health">
                <div class="section-card">
                    <h2>ğŸ’š ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§æŒ‡æ¨™</h2>
                    <div class="health-grid">
                        <div class="health-metric">
                            <div class="metric-header">
                                <span class="metric-icon">ğŸš€</span>
                                <h4>APIå¿œç­”æ€§èƒ½</h4>
                            </div>
                            <div class="metric-value good">å„ªè‰¯</div>
                            <div class="metric-description">å¹³å‡{{ "%.0f"|format(performance_data.avg_response_time) }}ms - ç›®æ¨™å€¤å†…</div>
                        </div>
                        
                        <div class="health-metric">
                            <div class="metric-header">
                                <span class="metric-icon">ğŸ”§</span>
                                <h4>ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡</h4>
                            </div>
                            <div class="metric-value excellent">{{ performance_data.success_rate }}%</div>
                            <div class="metric-description">é«˜ã„ç¨¼åƒç‡ã‚’ç¶­æŒ</div>
                        </div>
                        
                        <div class="health-metric">
                            <div class="metric-header">
                                <span class="metric-icon">ğŸ“Š</span>
                                <h4>ãƒ‡ãƒ¼ã‚¿å“è³ª</h4>
                            </div>
                            <div class="metric-value good">è‰¯å¥½</div>
                            <div class="metric-description">ãƒ­ã‚°ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒæ­£å¸¸</div>
                        </div>
                        
                        <div class="health-metric">
                            <div class="metric-header">
                                <span class="metric-icon">ğŸ”</span>
                                <h4>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ…‹</h4>
                            </div>
                            <div class="metric-value excellent">å®‰å…¨</div>
                            <div class="metric-description">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œãªã—</div>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer class="admin-footer">
            <p>ãƒ‡ãƒ¼ã‚¿åˆ†ææœŸé–“: {{ days }}æ—¥é–“ | {{ translation_analytics.time_range }} | LangPont Admin Phase B-1</p>
            <div class="footer-actions">
                <button onclick="generateReport()" class="btn btn-small">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                <button onclick="scheduleReport()" class="btn btn-small btn-outline">â° å®šæœŸãƒ¬ãƒãƒ¼ãƒˆ</button>
            </div>
        </footer>

    </div>

    <script>
        // ğŸš€ ç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿åˆ†æç”»é¢ JavaScript
        
        // ç¿»è¨³ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒ£ãƒ¼ãƒˆ
        const trendCtx = document.getElementById('translationTrendChart').getContext('2d');
        const trendData = {{ translation_analytics.daily_translations|tojson }};
        
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: trendData.map(d => d.date),
                datasets: [{
                    label: 'æ—¥åˆ¥ç¿»è¨³æ•°',
                    data: trendData.map(d => d.count),
                    borderColor: '#007AFF',
                    backgroundColor: 'rgba(0, 122, 255, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#007AFF',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'ç¿»è¨³æ•°'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'æ—¥ä»˜'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff',
                        borderColor: '#007AFF',
                        borderWidth: 1
                    }
                }
            }
        });

        // Geminiæ¨å¥¨ãƒãƒ£ãƒ¼ãƒˆ
        const geminiCtx = document.getElementById('geminiRecommendationChart').getContext('2d');
        const geminiData = {{ performance_data.gemini_recommendations|tojson }};
        
        new Chart(geminiCtx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(geminiData).map(key => key.charAt(0).toUpperCase() + key.slice(1)),
                datasets: [{
                    data: Object.values(geminiData),
                    backgroundColor: [
                        '#007AFF',  // ChatGPT
                        '#FF9500',  // Enhanced
                        '#34C759',  // Gemini
                        '#FF3B30'   // Others
                    ],
                    borderWidth: 3,
                    borderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff'
                    }
                }
            }
        });

        // JavaScripté–¢æ•°
        function refreshAnalytics() {
            location.reload();
        }

        function exportAnalytics() {
            const data = {
                period: {{ days }},
                translation_analytics: {{ translation_analytics|tojson }},
                performance_data: {{ performance_data|tojson }},
                system_stats: {{ system_stats|tojson }},
                export_timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `langpont_analytics_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function generateReport() {
            alert('ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚\n\nå°†æ¥çš„ã«ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›äºˆå®š:\n- PDFå½¢å¼ã®è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ\n- é€±æ¬¡ãƒ»æœˆæ¬¡ã‚µãƒãƒªãƒ¼\n- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹');
        }

        function scheduleReport() {
            alert('å®šæœŸãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚\n\nå°†æ¥çš„ã«ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›äºˆå®š:\n- è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°\n- ãƒ¡ãƒ¼ãƒ«é…ä¿¡è¨­å®š\n- Slacké€£æº');
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
        setInterval(async () => {
            try {
                const response = await fetch('/admin/api/system_stats');
                if (response.ok) {
                    const data = await response.json();
                    updateRealtimeStats(data.data);
                }
            } catch (error) {
                console.error('ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            }
        }, 60000); // 1åˆ†é–“éš”

        function updateRealtimeStats(stats) {
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆã®æ›´æ–°
            const responseTimeElement = document.querySelector('.stat-card:nth-child(1) .stat-number');
            const apiCallsElement = document.querySelector('.stat-card:nth-child(2) .stat-number');
            const translationsElement = document.querySelector('.stat-card:nth-child(4) .stat-number');
            
            if (responseTimeElement) responseTimeElement.textContent = Math.round(stats.avg_response_time) + 'ms';
            if (apiCallsElement) apiCallsElement.textContent = stats.total_api_calls;
            if (translationsElement) translationsElement.textContent = stats.total_translations;
        }

        // åˆæœŸåŒ–
        console.log('ğŸš€ LangPontç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿åˆ†æç”»é¢ Phase B-1 åˆæœŸåŒ–å®Œäº†');
    </script>

    <style>
        /* ãƒ‡ãƒ¼ã‚¿åˆ†æç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .controls-form {
            margin-top: 1rem;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 2rem;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .control-group select {
            padding: 0.5rem;
            border: 1px solid var(--border-light);
            border-radius: 6px;
            background: var(--bg-white);
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ */
        .trends-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .trend-chart {
            min-height: 300px;
        }

        .trend-summary h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .summary-stats {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--bg-light);
            border-radius: 8px;
        }

        .summary-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: 600;
            color: var(--primary-blue);
        }

        /* Geminiåˆ†æ */
        .gemini-analysis-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .gemini-chart {
            max-width: 400px;
            margin: 0 auto;
        }

        .gemini-insights h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .insights-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .insight-item {
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 8px;
        }

        .insight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .engine-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .recommendation-count {
            background: var(--primary-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .insight-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æ */
        .behavior-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .top-users-panel h3,
        .usage-patterns h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .users-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .user-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .user-count {
            background: var(--primary-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .user-progress {
            background: var(--border-light);
            border-radius: 4px;
            height: 6px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--primary-blue);
            height: 100%;
            transition: width 0.3s ease;
        }

        .pattern-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .pattern-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 8px;
        }

        .pattern-icon {
            font-size: 1.5rem;
        }

        .pattern-content h4 {
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .pattern-content p {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .health-metric {
            padding: 1.5rem;
            background: var(--bg-light);
            border-radius: 12px;
            text-align: center;
        }

        .metric-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .metric-icon {
            font-size: 1.5rem;
        }

        .metric-header h4 {
            color: var(--text-primary);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .metric-value.excellent {
            color: var(--success-green);
        }

        .metric-value.good {
            color: var(--primary-blue);
        }

        .metric-value.warning {
            color: var(--warning-orange);
        }

        .metric-value.danger {
            color: var(--danger-red);
        }

        .metric-description {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .trends-container,
            .gemini-analysis-container,
            .behavior-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .pattern-stats {
                grid-template-columns: 1fr;
            }
            
            .health-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>