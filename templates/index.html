<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <!-- â˜…ã“ã‚Œã‚’è¿½åŠ  -->
  <title>ç¿»è¨³æ¯”è¼ƒã‚¢ãƒ—ãƒªï¼ˆChatGPT vs Geminiï¼‰</title>
  <style>
    body {
      /* æ–°è¨˜è¿°ï¼ˆ8è¡Œç›®ï¼‰ */
      font-family: 'Meiryo', 'Yu Gothic', 'Hiragino Kaku Gothic ProN', sans-serif;
      background-color: #f9f9f9;
      padding: 40px;
      line-height: 1.6;
      margin: 0;
    }
    h1 {
      text-align: center;
      font-size: 26px;
      margin-bottom: 30px;
    }
    form {
      max-width: 900px;
      margin: auto;
    }
    .card {
      background-color: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      position: relative;
    }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
    }
    textarea {
      width: 100%;
      height: 120px;
      font-size: 14px;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      resize: vertical;
    }
    pre {
      background-color: #f3f3f3;
      padding: 12px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: 'Meiryo', 'Consolas', 'Menlo', 'monospace';
      font-size: 14px;
    }
    .translate-btn {
      background-color: #007bff;
      border: none;
      padding: 10px 20px;
      color: white;
      border-radius: 6px;
      margin-right: 10px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .translate-btn:hover {
      background-color: #0056b3;
    }
    .section-title {
      font-size: 18px;
      font-weight: bold;
      border-left: 4px solid #007bff;
      padding-left: 10px;
      margin-bottom: 10px;
      position: relative;
    }
    .copy-result-btn {
      position: absolute;
      top: 0;
      right: 0;
      width: 20px;
      height: 20px;
      background-color: transparent;
      cursor: pointer;
    }
    .copy-btn, .delete-btn {
      position: absolute;
      top: 10px;
      width: 20px;
      height: 20px;
      background-color: transparent;
      cursor: pointer;
    }
    .copy-btn { right: 40px; }
    .delete-btn { right: 10px; }
    .toast {
      position: absolute;
      top: -30px;
      right: 0;
      background-color: #333;
      color: #fff;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      display: none;
      z-index: 1000;
    }

    .flex-row {
      display: flex;
      gap: 20px;
      flex-direction: row;  /* â† å¿µã®ãŸã‚è¿½åŠ ã—ã¦æ˜ç¤º ã“ã‚Œã¯PCç”¨*/
    }

    @media (max-width: 768px) {
    /* ğŸ”¹ã‚«ãƒ¼ãƒ‰ã®ä½™ç™½ã‚’å°‘ã—ã‚¹ãƒªãƒ ã« */
      .card {
        margin-bottom: 12px;
        padding: 12px;
      }

    /* ã‚¹ãƒãƒ›ã§ã¯ã€æ¨ªä¸¦ã³ã‚’ç¸¦ã«å¤‰æ›´ */
      .flex-row {
        flex-direction: column !important;
      }

    /* ğŸ”¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã®ã‚µã‚¤ã‚ºãƒ»ä½™ç™½ã‚’èª¿æ•´ */
      .section-title {
        font-size: 14px;
        padding-left: 4px;
        margin-bottom: 4px;
      }

      .translate-btn {
        width: 100%;
        margin-bottom: 8px;
      }

      textarea,
      pre {
        font-size: 13px;
        padding: 8px;
      }

    /* ğŸ”¹ã€Œãƒ•ãƒ©ãƒ³ã‚¹èªã€ã€Œæ—¥æœ¬èªè¨³ã€ã®è¦‹å‡ºã—ã‚’å°‘ã—å°ã•ã */
      .flex-row > div > div:first-child {
        font-size: 14px;
        margin-bottom: 1px;
      }
    
    /* ã‚¹ãƒãƒ›æ™‚ã€ãƒœã‚¿ãƒ³å…¨ä½“ã‚’ç¸¦ã«ä¸¦ã¹ã€ä¸­å¤®æƒãˆ */
      .card .button-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .button-group .translate-btn,
      .button-group .reset-btn {
        width: 100%;
        max-width: 320px;
      }
    }

      .reset-btn {
        background-color: #e0e0e0;
        color: #333;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .reset-btn:hover {
        background-color: #c5c5c5;
      }

      .toggle-btn {
        background-color: #eee;
        color: #333;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }

      .toggle-btn:hover {
        background-color: #ddd;
      }

      .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #ccc;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        vertical-align: middle;
        margin-right: 10px;
      }

      @keyframes spin {
        0%   { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .app-title {
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        line-height: 1.4;
        margin-bottom: 30px;
      }

      .subtitle {
        font-size: 20px;
        display: inline-block;
        margin-top: 4px;
      }

      /* ğŸ”½ ã‚¹ãƒãƒ›ç”¨ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ */
      @media (max-width: 768px) {
        .app-title {
          font-size: 16px;
        }

        .subtitle {
          font-size: 12px;
        }
      }

  </style>
</head>
<body>
  <h1 class="app-title">
    ç¿»è¨³æ¯”è¼ƒã‚¢ãƒ—ãƒª<br class="mobile-break">
    <span class="subtitle">(ChatGPT vs Gemini)</span>
  </h1>
  <form method="POST" onsubmit="showLoading()">

  <!-- ğŸ”½ ã“ã“ã«è¿½åŠ ï¼ -->
  <input type="hidden" id="gemini_ready" value="{% if gemini_translation %}1{% else %}0{% endif %}">


    <div class="card">
      <label for="japanese_text">{{ labels["input_label"] }}</label>
      <textarea id="japanese_text" name="japanese_text" placeholder="ã“ã“ã«ç¿»è¨³ã—ãŸã„æ—¥æœ¬èªã‚’å…¥åŠ›">{{ japanese_text }}</textarea>
      <img src="{{ url_for('static', filename='copy-icon.png') }}" class="copy-btn" onclick="copyContent('japanese_text', 'toast-japanese')">
      <img src="{{ url_for('static', filename='delete-icon.png') }}" class="delete-btn" onclick="clearContent('japanese_text')">
      <div class="toast" id="toast-japanese">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>
    </div>

    <!-- ğŸ”½ æŠ˜ã‚ŠãŸãŸã¿é–‹é–‰ãƒœã‚¿ãƒ³ -->
    <div class="card">
      <button type="button" class="toggle-btn" onclick="toggleDetails()">â–¼ è©³ç´°å…¥åŠ›ã‚’è¡¨ç¤º</button>
    </div>

    <!-- ğŸ”½ æŠ˜ã‚ŠãŸãŸã‚€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆåˆæœŸçŠ¶æ…‹ï¼šéè¡¨ç¤ºï¼‰-->
    <div id="detail-section" style="display: none;">
      <div class="card">
        <label for="partner_message" style="margin-left:30px; font-size:14px;">ç›´å‰ã®ä¼šè©±ã®ã‚„ã‚Šå–ã‚Šï¼ˆä»»æ„ï¼‰</label>
        <textarea name="partner_message" style="margin-left:40px; width:calc(100% - 40px); height:50px;">{{ partner_message }}</textarea>
      </div>

      <div class="card">
        <label for="context_info" style="margin-left:30px; font-size:14px;">èƒŒæ™¯æƒ…å ±</label>
        <textarea name="context_info" placeholder="èƒŒæ™¯æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" style="margin-left:40px; width:calc(100% - 40px); height:50px;">{{ context_info or "ç§ã¯ãƒ•ãƒ©ãƒ³ã‚¹äººã¨ãƒ“ã‚¸ãƒã‚¹ã‚’ã—ã¦ã„ã¦ã€ç›¸æ‰‹ã¯ç§ã®ãŠå®¢æ§˜ã§ã™ã€‚ãŸã ã€ã‹ãªã‚Šãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªä»˜ãåˆã„ã‚’ã—ã¦ã„ã‚‹ã®ã§ã€ã‚ã¾ã‚Šå …è‹¦ã—ããªã‚‰ãªã„ã‚ˆã†ã«ã€ã—ã‹ã—å¤±ç¤¼ã®ãªã„ã‚ˆã†ãªãƒˆãƒ¼ãƒ³ã§ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚" }}</textarea>
      </div>
    </div>

    <input type="hidden" id="is-translated" value="{{ translated_text | length > 0 }}">

    <div class="card button-group">
      <button type="submit" class="translate-btn">{{ labels["translate_button"] }}</button>
      <button type="submit" name="reset" value="true" class="reset-btn">{{ labels["reset_button"] }}</button>

    </div>

    <div id="loading" style="display: none; text-align: center; margin-top: 20px; font-weight: bold;">
      <div class="spinner"></div>ç¿»è¨³ä¸­ã§ã™â€¦ å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚
    </div>

    {% for fr, jp, fr_id, jp_id, title in [
      (translated_text, reverse_translated_text, "translated-text", "reverse-translated-text", "ChatGPTã«ã‚ˆã‚‹ç¿»è¨³"),
      (better_translation, reverse_better_text, "better-translation", "reverse-better-translation", "ã‚ˆã‚Šè‰¯ã„ç¿»è¨³ææ¡ˆï¼ˆChatGPTï¼‰"),
      (gemini_translation, gemini_reverse_translation, "gemini-translation", "gemini-reverse-translation", "Geminiã«ã‚ˆã‚‹ç¿»è¨³")
    ] if fr and jp %}
    
    <div class="card">
      <div class="section-title">{{ title }}</div>
      <div class="flex-row">
        <div style="flex: 1; position: relative;">
          <div style="font-weight:bold; margin-bottom:4px;">ãƒ•ãƒ©ãƒ³ã‚¹èª</div>
          <pre id="{{ fr_id }}">{{ fr }}</pre>
          <img src="{{ url_for('static', filename='copy-icon.png') }}" class="copy-result-btn" style="top: 4px; right: 4px;" onclick="copyContent('{{ fr_id }}', 'toast-{{ fr_id }}')">
          <div class="toast" id="toast-{{ fr_id }}">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>
        </div>
        <div style="flex: 1; position: relative;">
          <div style="font-weight:bold; margin-bottom:4px;">æ—¥æœ¬èªè¨³</div>
          <pre id="{{ jp_id }}">{{ jp }}</pre>
          <img src="{{ url_for('static', filename='copy-icon.png') }}" class="copy-result-btn" style="top: 4px; right: 4px;" onclick="copyContent('{{ jp_id }}', 'toast-{{ jp_id }}')">
          <div class="toast" id="toast-{{ jp_id }}">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>
        </div>
      </div>
    </div>
    {% endfor %}    

    <!-- Geminiãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ï¼šéåŒæœŸã§å–å¾— -->
    <div class="card" id="gemini-nuance-card" style="display: none;">
      <div class="section-title">
        Geminiã«ã‚ˆã‚‹3æ–‡ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹è§£æ:
        <img src="{{ url_for('static', filename='copy-icon.png') }}" class="copy-result-btn" onclick="copyContent('gemini-3way-analysis', 'toast-gemini-3way')">
      </div>
      <pre id="gemini-3way-analysis">ğŸ§  ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹åˆ†æã‚’å–å¾—ä¸­...</pre>
      <div class="toast" id="toast-gemini-3way">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>
    </div>

    <!-- ğŸ”½ Geminiãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹å–å¾—ç”¨ãƒœã‚¿ãƒ³ï¼ˆå¾Œã‹ã‚‰ã‚¯ãƒªãƒƒã‚¯ã§ç™ºå‹•ï¼‰ -->
    <div class="card" id="gemini-nuance-trigger" style="display: none; text-align: center;">
      <button type="button" class="translate-btn" onclick="fetchGeminiNuance()">ğŸ§  Geminiãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã‚’å–å¾—ã™ã‚‹</button>
    </div>

    {% if translated_text or nuance_answer or chat_history %}
    <div class="card">
      <label for="nuance_question">{{ labels["additional_question"] }}</label>
      <textarea name="nuance_question" placeholder="ã•ã‚‰ã«è³ªå•ã—ãŸã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">{{ nuance_question }}</textarea>
      <button type="submit" class="translate-btn">è³ªå•ã‚’é€ä¿¡ã™ã‚‹</button>
    </div>
    {% endif %}

    {% if nuance_answer %}
    <div class="card">
      <div class="section-title">ChatGPTã®å›ç­”:</div>
      <pre>{{ nuance_answer }}</pre>
    </div>
    {% endif %}

    {% if chat_history %}
    <div class="card">
      <div class="section-title">è³ªå•ã¨å›ç­”ã®å±¥æ­´:</div>
      {% for item in chat_history %}
      <div style="margin-bottom: 10px">
        <strong>Q:</strong> {{ item.question }}<br>
        <strong>A:</strong> {{ item.answer }}
      </div>
      {% endfor %}
    </div>
    {% endif %}

  </form>

  <script>
    function copyContent(id, toastId) {
      const el = document.getElementById(id);
      const text = el ? (el.value || el.innerText) : "";
      navigator.clipboard.writeText(text);
      showToast(toastId);
    }
  
    function clearContent(name) {
      const el = document.querySelector(`[name='${name}']`);
      if (el) el.value = "";
    }
  
    function showToast(id) {
      const el = document.getElementById(id);
      if (el) {
        el.style.display = "block";
        setTimeout(() => { el.style.display = "none"; }, 1200);
      }
    }
  
    function toggleDetails() {
      const section = document.getElementById("detail-section");
      const button = document.querySelector(".toggle-btn");
      const isVisible = section.style.display === "block";
      section.style.display = isVisible ? "none" : "block";
      button.textContent = isVisible ? "â–¼ è©³ç´°å…¥åŠ›ã‚’è¡¨ç¤º" : "â–² è©³ç´°å…¥åŠ›ã‚’é–‰ã˜ã‚‹";
    }

    function showLoading() {
      const loading = document.getElementById("loading");
      if (loading) loading.style.display = "block";
    }

    window.addEventListener("DOMContentLoaded", () => {
      console.log("âœ… DOMContentLoaded ç™ºç«");

      const trigger = document.getElementById("gemini-nuance-trigger");
      const isReady = document.getElementById("gemini_ready")?.value === "1";

      console.log("âœ… gemini_ready å€¤: ", isReady);

      if (isReady && trigger) {
        trigger.style.display = "block";  // ğŸ¯ ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ã ã‘
        console.log("âœ… Geminiç¿»è¨³æ¸ˆã¿ â†’ ãƒœã‚¿ãƒ³è¡¨ç¤ºOK");
      } else {
        console.log("â¸ Geminiç¿»è¨³ãŒæœªå®Œäº†ã€ãƒœã‚¿ãƒ³éè¡¨ç¤º");
      }
    });

    function fetchGeminiNuance() {
      const el = document.getElementById("gemini-3way-analysis");
      const card = document.getElementById("gemini-nuance-card");
      if (!card || !el) return;

          card.style.display = "block";
          el.textContent = "ğŸ§  ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹åˆ†æã‚’å–å¾—ä¸­...";

          fetch("/get_nuance", {
            method: "POST",
            credentials: "include"
          })
          .then(response => response.json())
          .then(data => {
            if (data.nuance) {
              el.textContent = data.nuance;
              showToast("toast-gemini-3way");

                  // âœ… ã“ã“ã‚’è¿½åŠ ï¼
              const trigger = document.getElementById("gemini-nuance-trigger");
              if (trigger) trigger.style.display = "none";
            }
          })
          .catch(() => {
            el.textContent = "âš ï¸ Geminiåˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ";
          });
      }

  </script>
  
</body>

  <div style="text-align: right; margin-bottom: 10px;">
    ğŸŒ {{ labels["lang_switch"] }}ï¼š
    <a href="/set_language/en">EN</a> |
    <a href="/set_language/jp">JP</a> |
    <a href="/set_language/fr">FR</a>
  </div>

  <div style="text-align: right; margin-bottom: 10px;">
    <a href="/logout">ğŸ”“ {{ labels["logout"] }}</a>
  </div>

</html>

