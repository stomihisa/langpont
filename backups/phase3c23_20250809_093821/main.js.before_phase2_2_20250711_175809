// LangPont Main JavaScript Functions
// å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã•ã‚ŒãŸJavaScripté–¢æ•°ç¾¤

// ğŸ¯ Task B2-2: æœ€åˆã®ç§»è¡Œãƒ†ã‚¹ãƒˆé–¢æ•°
function showToast(message, type = 'info') {
  // æ—¢å­˜ã®showToasté–¢æ•°ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
  if (typeof window.showToast === 'function' && window.showToast !== showToast) {
    return window.showToast(message, type);
  }

  // ç°¡æ˜“å®Ÿè£…
  console.log(`Toast (${type}): ${message}`);
  
  // ç°¡æ˜“ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆé–‹ç™ºç”¨ï¼‰
  if (type === 'error') {
    console.error(message);
  } else if (type === 'success') {
    console.log(`âœ… ${message}`);
  } else {
    console.info(`â„¹ï¸ ${message}`);
  }
}

// ğŸ¯ Task B2-2 Phase 2-1: 6ã¤ã®æŒ‡å®šé–¢æ•°ã®ç§»è¡Œ

// 1. escapeHtml - HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// 2. getLanguagePair - è¨€èªãƒšã‚¢å–å¾—é–¢æ•°
function getLanguagePair() {
  const hiddenLanguagePair = document.getElementById('language_pair');
  return hiddenLanguagePair ? hiddenLanguagePair.value : 'ja-fr';
}

// 3. getCurrentLanguagePair - ç¾åœ¨ã®è¨€èªãƒšã‚¢å–å¾—é–¢æ•°
function getCurrentLanguagePair() {
  const sourceSelect = document.getElementById('source_language');
  const targetSelect = document.getElementById('target_language');
  
  if (sourceSelect && targetSelect) {
    return `${sourceSelect.value}-${targetSelect.value}`;
  }
  
  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šå¾“æ¥ã®language_pair
  const legacySelect = document.getElementById('language_pair');
  return legacySelect ? legacySelect.value : 'ja-en';
}

// 4. clearContent - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¯ãƒªã‚¢é–¢æ•°
function clearContent(elementId) {
  const el = document.getElementById(elementId);
  if (el) el.value = "";
}

// 5. formatChatTimestamp - ãƒãƒ£ãƒƒãƒˆæ™‚åˆ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
function formatChatTimestamp(timestamp) {
  if (!timestamp) return '';
  
  const date = new Date(timestamp * 1000);
  const now = new Date();
  const diffMs = now - date;
  const diffMins = Math.floor(diffMs / (1000 * 60));
  const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
  
  if (diffMins < 1) return 'Just now';
  if (diffMins < 60) return `${diffMins} min ago`;
  if (diffHours < 24) return `${diffHours} hours ago`;
  
  return date.toLocaleDateString('ja-JP', {
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
}

// 6. copyContent - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚³ãƒ”ãƒ¼é–¢æ•°
function copyContent(id, toastId, buttonElement) {
  const el = document.getElementById(id);
  const text = el ? (el.value || el.innerText) : "";
  navigator.clipboard.writeText(text);
  
  // ğŸ†• Task 2.9.1: ã€Œå‘½ã®ãƒœã‚¿ãƒ³ã€è¿½è·¡ - ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
  trackTranslationCopy(id, 'button_click', text);
  
  if (buttonElement) {
    showToastNearButton(toastId, buttonElement);
  } else {
    showToast(toastId);
  }
}
